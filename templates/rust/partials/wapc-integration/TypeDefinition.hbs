{{#switch name.value}}
  {{#case 'Inputs'}}
    #[derive(Debug, PartialEq, Deserialize, Serialize, Default, Clone)]
    pub struct InputEncoded {
    {{#each fields }}
      #[serde(rename = "{{name.value}}")]
      pub {{snakeCase name.value}}: Vec<u8>,
    {{/each}}
    }

    pub(crate) fn deserialize_inputs(
        args: InputEncoded,
    ) -> std::result::Result<
        {{pascalCase "Inputs"}},
        std::boxed::Box<dyn std::error::Error + std::marker::Send + std::marker::Sync>,
    > {
        Ok(Inputs {
            {{#each fields }}
            {{snakeCase name.value}}: deserialize(&args.{{snakeCase name.value}})?,
            {{/each}}
        })
    }

    #[cfg(feature = "guest")]
    #[derive(Debug, PartialEq, Deserialize, Serialize, Default, Clone)]
    pub struct {{pascalCase name.value}} {
      {{#each fields }}
      #[serde(rename = "{{name.value}}")]
      pub {{snakeCase name.value}}: {{> expand-type type }},
      {{/each}}
    }

  {{/case}}
  {{#case 'Outputs'}}
    pub(crate) fn get_outputs(inv_id: &str) -> Outputs<'_> {
        Outputs {
          {{#each fields}}
            {{snakeCase name.value}}: GuestPort{{pascalCase name.value}} { inv_id, },
          {{/each}}
        }
    }

    {{#each fields}}
    #[derive(Debug, PartialEq, Clone)]
    pub struct GuestPort{{pascalCase name.value}}<'a> {
        inv_id: &'a str,
    }

    impl<'a> GuestPort{{pascalCase name.value}}<'a> {
        #[allow(unused)]
        pub fn send(&self, payload: {{> expand-type type}}) -> CallResult {
            host_call(
                self.inv_id,
                "{{name.value}}",
                "port",
                 &serialize(Packet::V0(Payload::to_messagepack(payload)))?,
            )
        }
        #[allow(unused)]
        pub fn exception(&self, message: String) -> CallResult {
            host_call(
                self.inv_id,
                "{{name.value}}",
                "port",
                &serialize(Packet::V0(Payload::Exception(message)))?,
            )
        }
    }
    {{/each}}

    #[cfg(feature = "guest")]
    #[derive(Debug, PartialEq, Clone)]
    pub struct Outputs<'a> {
    {{#each fields}}
        pub {{snakeCase name.value}}: GuestPort{{pascalCase name.value}}<'a>,
    {{/each}}
    }
  {{/case}}
  {{#default}}
    #[cfg(feature = "guest")]
    #[derive(Debug, PartialEq, Deserialize, Serialize, Default, Clone)]
    pub struct {{pascalCase name.value}} {
      {{#each fields }}
      #[serde(rename = "{{name.value}}")]
      pub {{snakeCase name.value}}: {{> expand-type type }},
      {{/each}}
    }
  {{/default}}
{{/switch}}